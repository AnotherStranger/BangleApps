/*
 Copyright 2015-2018 Wouter Bulten
 @license MIT License
 @preserve
*/
(()=>{function k(b){f=!0;var a={x:0,y:0,z:0,mag:0};a.x=l.filter(b.x);a.y=m.filter(b.y);a.z=n.filter(b.z);a.mag=Math.sqrt(a.x*a.x+a.y*a.y+a.z*a.z);a.mag>d.mag&&(d=a)}function p(){var b={t:"accel",accel:f?d:Bangle.getAccel()};try{Bluetooth.println(""),Bluetooth.println(JSON.stringify(b))}catch(a){console.error("Failed to send message via Bluetooth:",a)}d={x:0,y:0,z:0,mag:0};f=!1}class g{constructor({R:b=1,Q:a=1,A:c=1,B:e=0,C:q=1}={}){this.R=b;this.Q=a;this.A=c;this.C=q;this.B=e;this.x=this.cov=NaN}filter(b,
a=0){if(isNaN(this.x))this.x=1/this.C*b,this.cov=1/this.C*this.Q*(1/this.C);else{a=this.predict(a);const c=this.uncertainty(),e=1/(this.C*c*this.C+this.Q)*this.C*c;this.x=a+e*(b-this.C*a);this.cov=c-e*this.C*c}return this.x}predict(b=0){return this.A*this.x+this.B*b}uncertainty(){return this.A*this.cov*this.A+this.R}lastMeasurement(){return this.x}setMeasurementNoise(b){this.Q=b}setProcessNoise(b){this.R=b}}const l=new g,m=new g,n=new g;var d={x:0,y:0,z:0,mag:0},f=!1,h=require("Storage").readJSON("accelsender.json")||
{};h.enabled&&(setInterval(p,h.interval),Bangle.on("accel",k))})();
